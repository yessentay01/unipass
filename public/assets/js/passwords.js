var senhaId=null,showSecretEnable=!1;$("#form").form({afterSave:function(e){e.errors||($("#modal").modal("hide"),dataTable.ajax.reload(showSecretEnable?showSecret(dataTable.rows({selected:!0}).data()[0]):null,!1))},afterDelete:function(e){e||(dataTable.ajax.reload(null,!1),showSecretEnable&&removeDivSecret())}}),$("#txtTipo").selectize({onChange:function(e){$("#form").find(".show").addClass("d-none").end().find(".show-"+e).removeClass("d-none")}});var options={ui:{container:"#pwd-container",showVerdicts:!1,viewports:{progress:".pwstrength_viewport_progress"},progressExtraCssClasses:"progress-sm"}};$("#txtPassword").pwstrength(options),$("#generatePassword").pGenerator({bind:"click",passwordElement:"#txtPassword",specialChars:!1,onPasswordGenerated:function(){$("#txtPassword").change()}});var $pw=$("#txtPassword"),$t=$("#showPassword ").find("i");$("#showPassword").click(function(){"password"===$pw.attr("type")?($pw.attr("type","text"),$t.removeClass("fa-eye").addClass("fa-eye-slash")):($pw.attr("type","password"),$t.addClass("fa-eye").removeClass("fa-eye-slash"))}),$("#modal").on("shown.bs.modal",function(){$("#txtRecurso").focus()}).on("hidden.bs.modal",function(){$("#form").form().cancel()}),$(".filterBy").change(function(){dataTable.ajax.reload(),removeDivSecret()}),$(".filterByType").change(function(){dataTable.ajax.reload(),removeDivSecret()});var dataTable=$("#table").DataTable({pageLength:15,order:[1,"asc"],ajax:{url:"api/passwords",type:"GET",data:function(e){return e.data_table=!0,e.filter_by=$(".filterBy:checked").val(),filterByFolder=$("#filterByFolder").jstree("get_selected"),$.isArray(filterByFolder)&&(e.filter_by_folder=filterByFolder),filterByType=[],$(".filterByType:checked").each(function(e,t){filterByType.push($(t).attr("data-id"))}),e.filter_by_type=filterByType,e}},select:{style:"single"},rowId:"id",dom:"<'row'<'col-9'f><'col-3'B>><'row rowTableSecret'<'col-12 colTableSecret'tr>><'card-footer d-flex align-items-center'ip>",buttons:[{text:'<button class="btn btn-primary w-xs float-right" onclick="create()">New</button>'}],columns:[{orderable:!1,width:"0",render:function(e,t,a){return'<a href="javascript:void(0)" id="favorite-'+a.id+'" title="Adicionar aos favoritos" onclick="event.stopPropagation();favorite('+a.id+');"><svg xmlns="http://www.w3.org/2000/svg" class="icon '+(a.favorite?"text-yellow":"text-muted")+'" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M12 17.75l-6.172 3.245 1.179-6.873-4.993-4.867 6.9-1.002L12 2l3.086 6.253 6.9 1.002-4.993 4.867 1.179 6.873z"></path></svg></a>'}},{title:"Passwords",data:"name",width:"80%"},{data:"id",orderable:!1,className:"text-right",width:"20%",render:function(e,t,a){return'<a href="javascript:void(0)" class="btn btn-white btn-icon btn-sm mr-2 '+(a.can_view?"":"disabled")+'" title="Visualizar" '+(a.can_view?"":"disabled")+'><svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="12" cy="12" r="2"></circle><path d="M2 12l1.5 2a11 11 0 0 0 17 0l1.5 -2"></path><path d="M2 12l1.5 -2a11 11 0 0 1 17 0l1.5 2"></path></svg></a><a href="javascript:void(0)" class="btn btn-white btn-icon btn-sm mr-2 '+(a.can_share?"":"disabled")+'" title="Compartilhar" '+(a.can_share?"":"disabled")+' onclick="event.stopPropagation();share('+e+');"><svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="6" r="3"></circle><circle cx="18" cy="18" r="3"></circle><line x1="8.7" y1="10.7" x2="15.3" y2="7.3"></line><line x1="8.7" y1="13.3" x2="15.3" y2="16.7"></line></svg></a><a href="javascript:void(0)" class="btn btn-white btn-icon btn-sm mr-2 '+(a.can_edit?"":"disabled")+'" title="Editar" '+(a.can_edit?"":"disabled")+' onclick="event.stopPropagation();edit('+e+');"><svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4"></path><line x1="13.5" y1="6.5" x2="17.5" y2="10.5"></line></svg></a><a href="javascript:void(0)" class="btn btn-white btn-icon btn-sm '+(a.can_delete?"":"disabled")+'" title="Excluir" '+(a.can_delete?"":"disabled")+' onclick="event.stopPropagation();remove('+e+');"><svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><line x1="4" y1="7" x2="20" y2="7"></line><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path></svg></a>'}}],drawCallback:function(){$('[data-toggle="popover"]').popover()}});function create(){$("#modal").modal("show")}function edit(e){$("#modal").modal("show"),$("#form").form().open(e)}function remove(e){$("#form").form().delete(e)}function share(e){senhaId=e,$("#modalCompartilhar").modal("show")}function favorite(e){$.request({url:"/api/passwords/"+e+"/favorite",method:"POST",after:function(){$("#favorite-"+e).find("svg").toggleClass("text-yellow text-muted")}})}function showDivSecret(){$(".colTableSecret").removeClass("col-12").addClass("col-5"),$(".rowTableSecret").append('<div class="col-7" id="colDivShowSecret"><div class="card border-bottom-0 border-right-0 h-full" id="divShowSecret"></div></div>'),showSecretEnable=!0}function removeDivSecret(){$(".colTableSecret").removeClass("col-7").addClass("col-12"),$(".rowTableSecret").find("#colDivShowSecret").remove(),showSecretEnable=!1}function showSecret(e){let t=$(".rowTableSecret").find("#divShowSecret");t.empty(),t.append('<div class="loader my-auto mx-auto"></div>'),$.request({url:"/api/passwords/"+e.id,after:function(a){let o="",s="",i="",r=!1;o+='<div class="card-header border-0"><h3 class="card-title">'+a.name+'</h3><div class="card-actions"><a href="javascript:void(0)" class="btn btn-white btn-icon btn-sm pull-right" title="Fechar" onclick="removeDivSecret()"><svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></a><a href="javascript:void(0)" class="btn btn-white btn-icon btn-sm pull-right mr-2 '+(e.can_delete?"":"disabled")+'" title="Excluir" '+(e.can_delete?"":"disabled")+' onclick="remove('+e.id+')"><svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><line x1="4" y1="7" x2="20" y2="7"></line><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path></svg></a><a href="javascript:void(0)" class="btn btn-white btn-icon btn-sm pull-right mr-2 '+(e.can_edit?"":"disabled")+'" title="Editar" '+(e.can_edit?"":"disabled")+' onclick="edit('+e.id+')"><svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4"></path><line x1="13.5" y1="6.5" x2="17.5" y2="10.5"></line></svg></a><a href="javascript:void(0)" class="btn btn-white btn-icon btn-sm pull-right mr-2 '+(e.can_share?"":"disabled")+'" title="Compartilhar" '+(e.can_share?"":"disabled")+' onclick="share('+e.id+')"><svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"></path><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="6" r="3"></circle><circle cx="18" cy="18" r="3"></circle><line x1="8.7" y1="10.7" x2="15.3" y2="7.3"></line><line x1="8.7" y1="13.3" x2="15.3" y2="16.7"></line></svg></a></div></div>',o+='<div class="card-body"><dl class="row">',o+='<dt class="col-4">Tipo:</dt><dd class="col-8">'+a.type_name+'</dd><dt class="col-4">Nome: </dt><dd class="col-8">'+a.name+"</dd>",$("#form").find(".show-"+a.type).each(function(e){s=$(this).find("label").text(),i=$(this).find("input").attr("name"),r="password"===i,null!==a[i]&&(o+=r?'<dt class="col-4">'+s+': </dt><dd class="col-8"><span class="pass-'+e+(r?"":" d-none")+' show">'+"*".repeat(a[i].length)+'</span><span class="pass-'+e+(r?" d-none":"")+' hidden" id="copy-'+e+'">'+a[i]+'</span><a href="javascript:void(0)" class="ml-2 showPass" data-index="'+e+'"><i class="fa fa-eye"></i></a><a href="javascript:void(0)" class="ml-2 copy" data-index="'+e+'"><i class="fa fa-copy"></i></a></dd>':'<dt class="col-4 '+(r?"d-none":"")+'">'+s+': </dt><dd class="col-8 '+(r?"d-none":"")+'"><span id="copy-'+e+'">'+a[i]+'</span><a href="javascript:void(0)" class="ml-2 copy" data-index="'+e+'"><i class="fa fa-copy"></a></i></dd>')}),null!==a.notes&&(o+='<dd class="col-12">'+a.notes+"</dd>"),o+="</dl></div>",t.empty(),t.append(o),t.on("click",".showPass",function(){let e=$(this),a=t.find(".pass-"+$(this).attr("data-index")+".show"),o=t.find(".pass-"+$(this).attr("data-index")+".hidden");e.find("i").removeClass("fa-eye").addClass("fa-eye-slash"),a.toggleClass("d-none"),o.toggleClass("d-none"),setTimeout(function(){e.find("i").removeClass("fa-eye-slash").addClass("fa-eye"),a.removeClass("d-none"),o.addClass("d-none")},3500)}),t.on("click",".copy",function(){let e=$(this);copy(t,t.find("#copy-"+$(this).attr("data-index")).text())&&(e.find("i").removeClass("fa-copy").addClass("fa-check-circle"),setTimeout(function(){e.find("i").removeClass("fa-check-circle").addClass("fa-copy")},500))})}})}$("#table").on("click","tbody > tr",function(){let e=$(this);e.find("td").hasClass("dataTables_empty")||(e.hasClass("selected")?removeDivSecret():(showSecretEnable||showDivSecret(),showSecret(dataTable.row(this).data())))}),$.request({url:"/api/folders/compact",after:function(e){var t=[];$.each(e,function(e,a){t.push({id:a.id,parent:a.folder_id||"#",text:a.name})}),$("#filterByFolder").jstree({core:{data:t,animation:0,themes:{stripes:!1,icons:!1,dots:!1}},checkbox:{keep_selected_style:!1},plugins:["checkbox"]}).on("select_node.jstree",function(){dataTable.ajax.reload(),removeDivSecret()}).on("deselect_node.jstree",function(){dataTable.ajax.reload(),removeDivSecret()})}});